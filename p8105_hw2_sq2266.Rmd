---
title: "p8105_hw2_sq2266"
author: "Sihan Qiu"
output: github_document
---




```{r setup}
library(tidyverse)
library(readxl)
```

## Problem 1
```{r}
transit_df = 
  read_csv("NYC_Transit_Subway_Entrance_And_Exit_Data.csv",col_types = cols(Route8 = "c", Route9 = "c", Route10 = "c", Route11 = "c")) |>
  janitor::clean_names() |>
  select(
    line, station_name, station_latitude, station_longitude, 
    starts_with("route"), entry, exit_only, vending, entrance_type, 
    ada) |> 
  mutate(entry = case_match(
    entry,
    "YES" ~ "TRUE",
    "NO" ~ "FALSE"
  )
  )
print(transit_df)
```

## Trying to combine key variables
```{r}
 transit_df |> 
  pivot_longer(
    route1:route11,
    names_to = "route_num",
    values_to = "route") |> 
  filter(route == "A") |> 
  select(station_name, line) |> 
  distinct()
```


Description: 
This dataset includes information of subway stations in New York City. Key variables includes `division`,`line`, `station_name`, `station_latitude`,`station_longitude`,`routes`, `entry`,`vending`,`entrance_type`, and `ada`. The data cleaning steps includes standardizing column names by using `janitor::clean_names` to make uppercase and lowercase separated, converting `entry` from a character variable to a logical variable. 




## Problem 2
### Cleaning and reading data
```{r}
mr_trash_df = 
  read_excel("202409 Trash Wheel Collection Data.new.xlsx", sheet = 1, skip = 1) |>
  janitor::clean_names() |>
  select(-x15, -x16) |>
  mutate(year=as.character(year)) |>
  mutate(sports_balls = as.integer(round(sports_balls,0))) |>
  mutate(trash_wheel = "Mr. Trash Wheel") |>
  filter(!is.na(dumpster)) |>
  relocate(trash_wheel) 
```

### Cleaning Professor Trash Wheel and Gwynnda
```{r}
prof_trash_df = 
  read_excel("202409 Trash Wheel Collection Data.new.xlsx", sheet = 2, na = c("NA",".",""),skip = 1) |>
  janitor::clean_names() |>
  mutate(trash_wheel = "Profesor Trash Wheel") |>
  mutate(year=as.character(year)) |>
  filter(!is.na(dumpster),!is.na(date)) |>
  relocate(trash_wheel)
```

```{r}
Gwy_trash_df = 
  read_excel("202409 Trash Wheel Collection Data.new.xlsx", sheet = 4,na = c("NA",".","")) |>
  janitor::clean_names() |>
  mutate(trash_wheel = "Gwynnda") |>
  mutate(year=as.character(year)) |>
  filter(!is.na(dumpster)) |>
  relocate(trash_wheel)
```

### Combining dataset
```{r}
total_trash_df = 
  bind_rows(mr_trash_df,prof_trash_df,Gwy_trash_df) |>
  janitor::clean_names()
```

### Data description

The dataset contains observations on `r nrow(total_trash_df)` three different datasets. The data includes `r ncol(total_trash_df)` variables, including month, year, different types of trash (plastic bottles, polystyrene, cigarette butts, glass bottle, plastic bags,wrappers,sports ball, and homes powered), also weight, and volume. The total weight of trash collected by Professor Trash Wheel is `pull(prof_trash_df,weight_tons)`. The total number of cigarette butts collected by Gwynnda in June of 2022 is `total_cig_butts_Gwy = sum(cigarette_butts, na.rm = TRUE)`.

### Calculation
```{r}
sum(pull(prof_trash_df,weight_tons),na.rm = TRUE)
```

```{r}
total_trash_df |>
  filter(trash_wheel == "Gwynnda", month == "June", year == "2022") |>
  summarise(total_cig_butts_Gwy = sum(cigarette_butts, na.rm = TRUE))
```



## Problem 3

### Importing three datasets
```{r}
bakers_df = 
  read_csv("gbb_datasets/bakers.csv", na = c("NA",".",""))|>
  janitor::clean_names()|>
  rename(name = baker_name) |>
  rename(age = baker_age) |>
  rename(occupation = baker_occupation) |>
  mutate(series = as.character(series))
print(bakers_df)

bakes_df = 
  read_csv("gbb_datasets/bakes.csv",na = c("NA",".","")) |>
  janitor::clean_names() |>
  relocate(baker) |>
  rename(name = baker) |>
  rename(signature = signature_bake) |>
  mutate(series = as.character(series)) |>
  mutate(episode =as.character(episode))|>
  arrange(name)

results_df = 
  read_csv("gbb_datasets/results.csv",na = c("NA",".","")) |>
  janitor::clean_names() |>
  rename(
    result = in_stayed_in_out_eliminated_star_baker_star_baker_winner_series_winner_runner_up_series_runner_up_wd_withdrew) |>
  rename(series =x1,episode =x2, name =x3, technical=x4) |>
  relocate(name) |>
  filter(!is.na(name)) |>
  mutate(series = as.character(series))
```

```{r}
bakes1_df = 
  read_csv("gbb_datasets/bakes.csv",na = c("NA",".","")) |>
  janitor::clean_names() 
```

```{r}
bakers_bake_df = 
  inner_join(bakers_df, bakes_df)

merged_df = 
  inner_join(bakers_bake_df, results_df) 
```

### Checking completness and correctness ?
```{r}
missing_bakers_in_bake_df = 
  anti_join(bakers_df, bakes_df, by=c("name"))
missing_brakers_in_results_df =
  anti_join(bakers_df, results_df, by=c("name"))
```

### Combining datasets
```{r}

```



### Create a reader-friendly table
```{r}
star_baker_df = 
```


### Importing viewer.csv
```{r}
viewer_df = 
  read_csv("gbb_datasets/viewers.csv",na = c("NA",".",""))
  janitor::clean_names()
```

```{r}
  mean(pull(viewer_df,"Series 1"),na.rm = TRUE) 
  mean(pull(viewer_df,"Series 5"),na.rm = TRUE) 
```


